---
lab:
    title: '07 - Azure Storage 관리'
    module: '모듈 07 - Azure Storage'
---

# 랩 07 - Azure Storage 관리
# 학생 랩 매뉴얼

## 랩 시나리오

현재 온-프레미스 데이터 저장소에 있는 파일을 저장하기 위한 Azure Storage의 사용을 평가해야 합니다. 이러한 파일의 대부분은 자주 액세스하지 않지만 몇 가지 예외가 있습니다. 자주 보지 않는 파일을 저렴한 스토리지 계층에 배치하여 스토리지 비용을 최소화하려고 합니다. 또한 네트워크 액세스, 인증, 권한 부여 및 복제를 포함하여 Azure Storage가 제공하는 다양한 보호 메커니즘을 탐색할 계획입니다. 마지막으로, Azure Files 서비스가 온프레미스 파일 공유를 호스팅하는 데 적합한 정도를 확인해야 합니다.

## 목적

이 랩에서는 다음 작업을 수행합니다.

+ 작업 1: 랩 환경 프로비전
+ 작업 2: Azure Storage 계정 만들기 및 구성 
+ 작업 3: Azure Blob 저장소
+ 작업 4: Azure Storage에 대한 인증 및 권한 부여 관리
+ 작업 5: Azure Files공유 만들기 및 구성
+ 작업 6: Azure Storage에 대한 네트워크 액세스 관리

## 예상 시간: 40분

## 지침

### 연습 1

#### 작업 1: 랩 환경 프로비전

이 작업에서는 이 랩의 나중에 사용할 Azure 가상 머신을 배포합니다. 

1. [Azure Portal](https://portal.azure.com)에 로그인합니다.

1. Azure Portal 오른쪽 상단에 아이콘을 클릭하여 **Azure Cloud Shell**을 엽니다.

1. **Bash**또는 **PowerShell** 중 하나를 선택하라는 메시지가 표시되면 **PowerShell**을 선택합니다.      

    >**메모**: **Cloud Shell**을 처음 시작할 때 **탑재된 스토리지가 없음** 메시지가 나타나면 이 랩에서 사용 중인 구독을 선택하고 **스토리지 만들기**를 클릭합니다. 

1. Cloud Shell 창의 도구 모음에서 **파일 업로드/다운로드 아이콘을** 클릭하고 드롭다운 메뉴에서 파일 **업로드를** 클릭하고 **\\Allfiles\\Module_07\\az104-vm-template.json** 및 **\\Allfiles\\Module_07\\az104-07-vm-parameters.json**을 Cloud Shell 홈 디렉토리에 업로드합니다.

1. Cloud Shell 창에서 다음을 실행하여 가상 머신을 호스팅할 리소스 그룹을 만듭니다(`[Azure_region]` 자리 표시자를 Azure 가상 머신을 배포하려는 Azure 지역의 이름으로 바꿉니다).

   ```pwsh
   $location = '[Azure_region]'

   $rgName = 'az104-07-rg0'

   New-AzResourceGroup -Name $rgName -Location $location
   ```
1. Cloud Shell 창에서 업로드된 템플릿 및 매개 변수 파일을 사용하여 다음을 실행하고 가상 머신을 배포합니다.

   ```pwsh
   New-AzResourceGroupDeployment `
      -ResourceGroupName $rgName `
      -TemplateFile $HOME/az104-07-vm-template.json `
      -TemplateParameterFile $HOME/az104-07-vm-parameters.json `
      -AsJob
   ```

    >**메모**: 배포가 끝날 때까지 기다리지 말고 다음 작업을 진행하세요. 

1. Cloud Shell 창을 닫습니다.

#### 작업 2: Azure Storage 계정 만들기 및 구성 

이 작업에서는 Azure 스토리지 계정을 만들고 구성합니다. 

1. Azure Portal에서 **스토리지 계정**을 검색, 선택하고 **+ 추가**를 클릭합니다.

1. **스토리지 계정 만들기** 블레이드의 **기본** 탭에서 다음 설정(다른 설정은 기본값으로 둡니다)을 구성합니다.

    | 설정 | 값 | 
    | --- | --- |
    | 구독 | 이 랩에서 사용 중인 Azure 구독의 이름 |
    | 리소스 그룹 | 새 리소스 그룹 **az104-LabRG**의 이름 |
    | 스토리지 계정 이름 | 문자와 숫자로 구성된 길이 3에서 24 사이의 모든 전 영역 고유 이름 |
    | 위치 | Azure Storage 계정을 만들 수 있는 Azure 지역 이름  |
    | 성능  | **표준** |
    | 계정 종류 | **저장소 (범용 v1)** |
    | 복제 | **RA-GRS(읽기 액세스 지역 중복 저장소)** |

1. **다음: 네트워킹 >** 을 클릭합니다.**스토리지 계정 만들기** 블레이드의 **네트워킹** 탭에서 사용 가능한 옵션을 검토하고 기본 옵션 **공용 엔드포인트(모든 네트워크)** 를 수락하고 클릭합니다. **다음: 고급 >** 으로 이동합니다.

1. **스토리지 계정 만들기** 블레이드의 **고급** 탭에서 사용 가능한 옵션을 검토하고 기본값을 수락하고 **검토 + 만들기**를 클릭합니다. 그리고 유효성 검사 프로세스가 완료될 때까지 기다렸다가 **만들기**를 클릭합니다.

    >**참고**: 스토리지 계정이 생성될 때까지 기다립니다. 약 2분가량 소요됩니다.

1. 배포 블레이드에서 **리소스로 이동**을 클릭하여 Azure Storage 계정 블레이드를 표시합니다.  

1. Azure 스토리지 계정 블레이드의 **설정** 섹션에서 **구성**을 클릭합니다.

1. 스토리지 계정 종류를 **스토리지(범용 v1)에서 스토리지 V2(범용 v2)** 로 변경하려면 **업그레이드**를 클릭합니다.    

1. **스토리지 계정 업그레이드** 블레이드에서 업그레이드가 영구적이고 요금이 청구된다는 경고를 검토하고 **업그레이드 확인** 텍스트 상자에서 스토리지 계정 이름을 입력합니다. 그리고 **업그레이드**를 클릭합니다.      

    > **참고**: 프로비전 시간에 계정 종류를 **StorageV2(범용 v2)** 로 설정하는 옵션이 있습니다. 이전 두 단계는 기존 범용 v1 계정을 업그레이드할 옵션도 있음을 설명하기 위한 것입니다.

    > **참고**: **StorageV2(범용 v2)** 는 범용 v1 계정에서 사용할 수 없는 액세스 계층화와 같은 여러 기능을 사용합니다.

    > **참고**:  다른 구성 옵션도 검토하십시오. 현재 **핫**으로 설정되어 있으며 수정 가능한 **액세스 계층(기본값)**, 현재 **표준**으로 설정되어 있으며 계정 프로비전 중에만 설정 가능한 **성능**, Azure Active Directory Domain Services가 필요한 **Azure 파일 인증을 위한 ID 기반 디렉터리 서비스** 등이 포함됩니다.

1. 스토리지 계정 블레이드 **설정** 섹션에서 **지역 복원**을 클릭하고 보조 위치를 기록합니다. **스토리지 엔드포인트** 레이블 아래의 **모두 보기** 링크를 클릭하고 **스토리지 계정 엔드포인트** 블레이드를 검토합니다.       

    > **참고**: 예상대로, **스토리지 계정 엔드포인트** 블레이드에는 기본 엔드포인트와 보조 엔드포인트가 포함됩니다. 

1. 스토리지 계정의 구성 블레이드로 전환하고 **복제** 드롭다운 목록에서 **GRS(지역 중복 저장소)** 를 선택한 후 변경 사항을 저장합니다.

1. **지역에서 복제** 블레이드로 돌아가고 보조 위치가 여전히 지정되어 있는 것을 확인합니다. **스토리지 엔드포인트** 레이블 아래의 **모두 보기** 링크를 클릭하고 **스토리지 계정 엔드포인트** 블레이드를 검토합니다.       

    > **참고**: 예상대로 **스토리지 계정 엔드포인트** 블레이드에는 기본 엔드포인트만 포함됩니다. 

1.  **복제** 드롭다운 목록에서 스토리지 계정의 **구성** 블레이드를 다시 표시하여 **LRS(로컬 중복 저장소)** 를 선택하고 변경된 부분을 저장합니다.     

1. **지역에서 복제** 블레이드로 다시 전환하고 이 시점에서 스토리지 계정은 기본 위치만 있음을 확인합니다. 

1. 스토리지 계정의 **구성** 블레이드를 다시 표시하고 **액세스 계층(기본값)** 을 **쿨**로 설정합니다.

    > **참고**: 쿨 액세스 계층은 자주 보지 않는 데이터에 최적화되었습니다.

#### 작업 3: Azure Blob 저장소

이 작업에서는 Blob 컨테이너를 만들고 해당 컨테이너에 Blob을 업로드합니다. 

1. 스토리지 계정 블레이드 **Blob 서비스** 섹션에서 **컨테이너**를 클릭합니다.   

1. **+컨테이너**를 클릭하고 다음 설정을 사용하여 컨테이너를 만듭니다. 

    | 설정 | 값 |
    | --- | --- |
    | 이름 | **az104-07-container**  |
    | 공용 액세스 수준 | **개인(익명 권한 없음)** |

1. 컨테이너 목록에서 **az104-07-container**를 클릭한 다음 **업로드**를 클릭합니다.   

1. 랩 컴퓨터에서 **\\Allfiles\\Module_07\\LICENSE** 로 이동하고 **열기**를 클릭합니다.   

1.  **Blob 업로드** 블레이드에서 **고급** 섹션을 확장하고 다음 설정을 지정합니다(다른 설정은 기본값으로 남깁니다).   

    | 설정 | 값 |
    | --- | --- |
    | 인증 유형 | **계정 키**  |
    | Blob 유형 | **블록 Blob** |
    | 블록 크기 | **4MB** |
    | 액세스 계층 | **핫** |
    | 폴더에 업로드 | **라이선스** |

    > **참고**: 개별 Blob에 대해 액세스 계층을 설정할 수 있습니다.

1.  **업로드**를 클릭합니다. 

    > **참고**: 업로드하면 **licenses**라는 이름의 하위 폴더가 자동으로 생성됩니다. 

1. **az104-07-container** 블레이드로 돌아가 **licenses**와 **LICENSE**를 차례로 클릭합니다.     

1. **licenses/LICENSE** 블레이드에서 사용 가능한 옵션을 검토합니다. 

    > **참고**: Blob을 다운로드하고 액세스 계층을 변경하고 액세스 계층을 변경하고(현재 **쿨**로 설정되어 있음) 임대를 취득하여 임대 상태를 **잠금**으로 변경하고(현재 **잠금해제**로 설정됨) Blob이 수정 또는 삭제되지 않도록 보호하고 사용자 지정 메타데이터를 할당할 수 있습니다(임의의 키 및 값 쌍을 지정함). 또한 먼저 다운로드하지 않고 Azure Portal 인터페이스 내에서 직접 파일을 **편집**할 수 있습니다.  스냅샷을 만들고 SAS 토큰을 생성할 수도 있습니다(다음 작업에서 이 옵션을 탐색합니다). 

#### 작업 4: Azure Storage에 대한 인증 및 권한 부여 관리

이 작업에서는 Azure 스토리지에 대한 인증 및 권한 부여를 구성합니다.

1.  **licenses/LICENSE** 블레이드 **개요** 탭에서 **URL** 항목 옆의 **클립보드로 복사** 단추를 클릭합니다.       

1. InPrivate 모드를 사용하여 다른 브라우저 창을 열고 이전 단계에서 복사한 URL로 이동합니다. 

1.  **ResourceNotFound**를 나타내는 XML 서식의 메시지가 표시됩니다.

    > **참고**: 생성한 컨테이너의 공용 액세스 수준이 **개인(익명 권한 없음)** 으로 설정되어 있기 때문에 예상된 결과입니다.

1. InPrivate 모드 브라우저 창을 닫고 Azure Storage 컨테이너의 **licenses/LICENSE** 블레이드를 표시하는 브라우저 창으로 돌아가서 **SAS 생성** 탭으로 전환합니다.

1. **licenses/LICENSE** 블레이드의 **SAS 생성** 탭에서 다음 설정을 지정합니다(다른 설정은 기본값으로 남깁니다).

    | 설정 | 값 |
    | --- | --- |
    | 권한 | **읽기** |
    | 시작 날짜 | 어제 날짜 |
    | 시작 시간 | 현재 시간 |
    | 만료 날짜 | 내일 날짜 |
    | 만료 시간 | 현재 시간 |
    | 허용된 IP 주소 | 비워 둠 |
    | 허용된 프로토콜 | **HTTP** |
    | 서명 키 | **키 1** |

1. **SAS 토큰 및 URL 생성**을 클릭합니다.

1. **Blob SAS URL** 항목 옆로 있는 **클립보드에 복사** 버튼을 클릭합니다.

1. InPrivate 모드를 사용하여 다른 브라우저 창을 열고 이전 단계에서 복사한 URL로 이동합니다. 

    > **참고**: Microsoft Edge 또는 Internet Explorer를 사용하는 경우 **MIT 라이선스(MIT)** 페이지가 표시됩니다. Chrome이나 Firefox를 사용하는 경우 파일을 다운로드하고 메모장으로 열어 내용을 볼 수 있습니다.

    > **참고**: 이는 예상된 일입니다. 귀하의 액세스는 새로 생성된 SAS 토큰을 기반으로 권한이 부여되었기 때문입니다.

    > **참고**: Blob SAS URL을 저장합니다. 잠시 후 이 랩에서 필요합니다.

1. InPrivate 모드 브라우저 창을 닫고 Azure Storage 컨테이너의 **licenses/LICENSE** 블레이드를 표시하는 브라우저 창으로 돌아가서 다시  **az104-07 -컨테이너**블레이드로 이동합니다.

1. **인증 방법** 레이블 옆에 있는 **Azure AD 사용자 계정으로 전환** 링크를 클릭합니다.

    > **참고**: 이 시점에서 컨테이너에 더 이상 액세스할 수 없습니다. 

1. **az104-07-container** 블레이드에서 **액세스 제어(IAM)** 를 클릭합니다.

1. **역할 할당 추가** 섹션에서 **추가**를 클릭합니다.

1. **역할 관리자 추가** 블레이드에서 다음 설정을 지정합니다.

    | 설정 | 값 |
    | --- | --- |
    | 역할 | **Storage Blob 데이터 소유자** |
    | 다음에 대한 액세스 할당 | **Azure AD 사용자, 그룹 또는 서비스 주체** |
    | 선택 | 사용자 계정의 이름 |

1. 변경 사항을 저장하고 **az104-07-container** 컨테이너 **개요** 블레이드로 돌아가 컨테이너에 다시 액세스할 수 있는지 확인 합니다.

#### 작업 5: Azure Files 공유 만들기 및 구성

이 작업에서는 Azure Files 공유를 만들고 구성합니다.

   > **참고**: 본 작업을 시작하기 전에 이 랩의 첫 번째 작업에서 프로비전한 가상 머신이 실행 중인지 확인하십시오.

1. Azure Portal에서 이 랩의 첫 번째 작업에서 만든 스토리지 계정의 블레이드로 다시 이동하여 **파일 서비스** 섹션에서 **파일 공유**를 클릭합니다.

1. **+파일 공유**를 클릭하고 다음 설정으로 파일 공유를 만듭니다.

    | 설정 | 값 |
    | --- | --- |
    | 이름 | **az104-07-share** |
    | 할당량 | **1024** |

1. 새로 만든 파일 공유를 클릭한 다음 **연결**을 클릭합니다.

1. **연결** 블레이드에서 **Windows** 탭이 선택되어 있는지 확인하고 **클립보드로 복사**를 클릭합니다.

1. Azure Portal에서 **가상 머신**을 검색하여 선택하고 가상 머신 목록에서 **az104-07-vm0**을 클릭합니다.

1. **az104-07-vm0** 블레이드 **작업** 섹션에서 **명령 실행**을 클릭합니다. 

1. **az104-07-vm0 - Run command** 블레이드에서 **RunPowerShellScript**를 클릭합니다. 

1. **실행 명령 스크립트** 블레이드에서 이 작업의 앞에서 복사한 스크립트를 **PowerShell 스크립트** 창에 붙여넣고 **실행**을 클릭합니다.

1. 스크립트가 성공적으로 완료되었는지 확인합니다. 

1. **PowerShell 스크립트** 창의 내용을 다음 스크립트로 바꾸고 **실행**을 클릭합니다.

   ```pwsh
   New-Item -Type Directory -Path 'Z:\az104-07-folder'

   New-Item -Type File -Path 'Z:\az104-07-folder\az-104-07-file.txt'
   ```

1. 스크립트가 성공적으로 완료되었는지 확인합니다. 

1. **az104-07-share** 파일 공유 블레이드로 다시 이동하여 **새로 고침**을 클릭하고 **az104-07-folder**가 폴더 목록에 나타나는지 확인합니다. 

1. **az104-07-folder**를 클릭하고 **az104-07-file.txt**가 파일 목록에 나타나는지 확인합니다.

#### 작업 6: Azure Storage에 대한 네트워크 액세스 관리

이 작업에서는 Azure Storage에 대한 네트워크 액세스를 구성합니다.

1. Azure Portal에서 이 랩의 첫 번째 작업에서 만든 스토리지 계정의 블레이드로 다시 이동하여 **설정** 섹션에서 **방화벽 및 가상 네트워크**를 클릭합니다.

1. **선택한 네트워크** 옵션을 클릭하고 이 옵션이 활성화되면 사용할 수 있는 구성 설정을 검토합니다.

    > **참고**: 이러한 설정으로 서비스 엔드포인트를 사용하여 가상 네트워크의 지정된 서브넷에 있는 Azure 가상 머신과 스토리지 계정 간의 직접 연결을 구성할 수 있습니다. 

1. **클라이언트 IP 주소 추가** 확인란을 클릭하고 변경 내용을 저장합니다.

1. InPrivate 모드를 사용하여 다른 브라우저 창을 열고 이전 작업에서 생성한 Blob SAS URL로 이동합니다. 

1. **MIT 라이선스(MIT)** 페이지의 콘텐츠가 표시됩니다.

    > **참고**: 클라이언트 IP 주소에서 연결하므로 이것은 예상한 것입니다.

1. InPrivate 모드 브라우저 창을 닫고 Azure Storage 컨테이너의 **licenses/LICENSE** 블레이드를 표시하는 브라우저 창으로 돌아가서 Azure Cloud Shell 창을 엽니다.

1. Azure Portal 오른쪽 상단에 아이콘을 클릭하여 **Azure Cloud Shell**을 엽니다.

1. **Bash**또는 **PowerShell** 중 하나를 선택하라는 메시지가 표시되면 **PowerShell**을 선택합니다.      

1. Cloud Shell 창에서 다음 명령을 실행하여 스토리지 계정의 **az104-07-container** 컨테이너에서 LICENSE Blob을 다운로드해봅니다(`[blob SAS URL]` 자리 표시자를 이전 작업에서 생성한 Blob SAS URL로 바꿉니다).

   ```pwsh
   Invoke-WebRequest -URI '[blob SAS URL]'
   ```
1. 다운로드 시도가 실패하였는지 확인합니다. 

    > **참고**: **이 요청은 이 작업 수행 권한이 없습니다**. 이것은 Cloud Shell 인스턴스를 호스팅하는 Azure VM에 할당된 IP 주소에서 연결하기 때문에 예상한 것입니다.

1. Cloud Shell 창을 닫습니다.

#### 리소스 정리

   >**참고**: 더 이상 사용하지 않는 새로 만든 Azure 리소스를 제거해야 합니다. 사용하지 않는 리소스를 제거하면 해당 비용이 발생하지 않습니다.

1. Azure Portal에서 **Cloud Shell** 창 내부의 **PowerShell** 세션을 엽니다.

1. 다음 명령을 실행하여 본 모듈의 랩 전체에서 만든 모든 리소스 그룹을 나열합니다.

   ```pwsh
   Get-AzResourceGroup -Name 'az104-07*'
   ```

1. 다음 명령을 실행하여 본 모듈의 랩 전체에서 만든 모든 리소스 그룹을 삭제합니다.

   ```pwsh
   Get-AzResourceGroup -Name 'az104-07*' | Remove-AzResourceGroup -Force -AsJob
   ```

    >**참고**: 명령은 비동기적으로 실행(-AsJob 매개 변수에 의해 결정)되므로 동일한 PowerShell 세션 내에서 즉시 다른 PowerShell 명령을 실행할 수 있지만 리소스 그룹이 실제로 삭제되기까지 몇 분 정도 걸릴 수 있습니다.

#### 리뷰

이 랩에서는 다음 작업을 했습니다.

- 랩 환경 프로비전 
- Azure Storage 계정 만들기 및 구성 
- Blob Storage 관리
- Azure Storage에 대한 인증 및 권한 부여 관리
- Azure Files 공유를 만들고 구성
- Azure Storage에 대한 네트워크 액세스 관리
