---
lab:
    title: '09a - Web App 구현'
    module: '모듈 09 - 서버리스 컴퓨팅'
---

# 랩 09a - Web Apps 구현
# 학생 랩 매뉴얼

## 랩 시나리오

현재 회사의 온-프레미스 데이터 센터에서 호스팅되는 Contoso의 웹 사이트를 호스팅하기 위해 Azure Web Apps 사용을 평가해야 합니다. PHP 런타임 스택을 사용하는 Windows 서버에서 웹 사이트가 실행되고 있습니다. 또한 Azure Web Apps 배포 슬롯을 활용하여 DevOps 사례를 구현할 수 있는 방법을 결정해야 합니다.

## 목적

이 랩에서는 다음 작업을 수행합니다.
  
+ 작업 1: Azure 웹앱 만들기
+ 작업 2: 스테이징 배포 슬롯 만들기
+ 작업 3: 웹앱 배포 설정을 구성합니다.
+ 작업 4: 스테이징 배포 슬롯에 코드 배포
+ 작업 5: 스테이징 슬롯 교체
+ 작업 6: Azure 웹앱의 자동 크기 조정 구성 및 테스트
  
## 지침

### 연습 1

#### 작업 1: Azure 웹앱 만들기

이 작업에서는 Azure 웹앱을 만듭니다. 

1. [**Azure Portal**](http://portal.azure.com)에 로그인합니다.

1. Azure portal에서 **앱 서비스**를 검색하고 선택하고 **앱 서비스** 블레이드에서 **+ 추가**를 클릭합니다.

1. **웹앱** 블레이드의 **기본** 탭에서 다음 설정을지정합니다(다른 설정은 기본값으로 남음).   

    | 설정 | 값 |
    | --- | ---|
    | 구독 | 이 랩에서 사용 중인 Azure 구독의 이름 |
    | 리소스 그룹 | 새 리소스 그룹 **az104-09a-rg1**의 이름 |
    | 웹앱 이름 | 전역으로 고유한 이름 |
    | 게시 | **코드** |
    | 런타임 스택 | **PHP 7.3** |
    | 운영 체제 | **Windows** |
    | 영역 | Azure 웹앱을 프로비전할 수 있는 Azure 영역 이름 |
    | App Service 계획 | 기본 구성 적용 |

1. **다음: 모니터링 >** 을 클릭하고 **웹앱** 블레이드의 **모니터링** 탭에서 **Application Insights 사용** 스위치를 **아니요**로 설정하여 **검토 +만들기**를 클릭한 다음 **만들기**를 클릭합니다. 

    >**참고**: 일반적으로 **Application Insights**를 사용하도록 설정하려는 경우 이 랩에서는 해당 기능이 사용되지 않습니다.

    >**참고**: 웹앱이 생성될 때까지 기다린 후 다음 작업을 진행합니다. 이 작업에 약 1분 정도 걸릴 것입니다. 

1. 배포 블레이드에서 **리소스로 이동**을 클릭합니다.

#### 작업 2: 스테이징 배포 슬롯 만들기

이 작업에서는 스테이징 배포 슬롯를 만듭니다. 

1. 새로 배포된 웹앱의 블레이드에서 **URL** 링크를 클릭하여 새 브라우저 탭에 기본 웹 페이지를 표시합니다. 

1. 새 브라우저 탭을 닫고 Azure Portal에서 웹앱 블레이드의 **배포** 섹션에서 **배포 슬롯**을 클릭합니다. 

    >**참고**: 웹앱에는 이 시점에서 **PRODUCTION**이라는 레이블의 단일 배포 슬롯이 있습니다. 

1.  **+ 슬롯 추가**를 클릭하고 다음 설정으로 새 슬롯을 추가합니다.  

    | 설정 | 값 |
    | --- | ---|
    | 이름 | **준비** |
    | 다음의 설정 복제 | **설정을 복제하지 않음**|

1. 웹앱의 **배포 슬롯** 블레이드로 돌아가서 새로 만든 스테이징 슬롯을 나타내는 항목을 클릭합니다. 

    >**참고**: 그러면 스테이징 슬롯의 속성을 표시하는 블레이드가 열립니다. 

1. 스테이징 슬롯 블레이드를 검토하고 URL이 프로덕션 슬롯에 할당된 URL과 다르다는 점에 유의하십시오.

#### 작업 3: 웹앱 배포 설정을 구성합니다.

이 작업에서는 웹앱 배포 설정을 구성합니다. 

1. 스테이징 배포 슬롯 블레이드의 **배포** 섹션에서 **배포 센터**를 클릭합니다.

    >**참고:** 스테이징 슬롯 블레이드(프로덕션 슬롯이 아닌)에 있는지 확인합니다.

1. **지속적인 배포(CI/CD)** 섹션에서 **로컬 Git**을 선택한 다음 **계속**을 클릭합니다.

1. **App Service 빌드 서비스**를 선택하고 **계속**을 클릭한 다음 **완료**를 클릭합니다. 

1. 결과 **Git Clone Url**을 메모장 기록합니다.

    >**참고:** 이 랩의 다음 작업에서 Git Clone URL 값이 필요합니다.

1. **배포 자격 증명** 도구 모음 아이콘을 클릭하여 **배포 자격 증명** 창을 표시합니다. 

1. **사용자 자격 증명**을 클릭합니다.

1. 필요한 정보를 모두 입력한 다음 **자격 증명 저장**을 클릭합니다. 

    | 설정 | 값 |
    | --- | ---|
    | 사용자 이름 | 모든 고유 이름 |
    | 암호 | **Pa55w0rd1234** |

    >**참고:** 이 랩의 다음 작업에서 이 자격 증명이 필요합니다.

#### 작업 4: 스테이징 배포 슬롯에 코드 배포

이 작업에서는 스테이징 배포 슬롯에 코드를 배포합니다.

1. Azure Portal 오른쪽 상단에 아이콘을 클릭하여 **Azure Cloud Shell**을 엽니다.

1. **Bash**또는 **PowerShell** 중 하나를 선택하라는 메시지가 표시되면 **PowerShell**을 선택합니다.      

    >**참고**: **Cloud Shell**을 처음 시작할 때 **탑재된 스토리지가 없음** 메시지가 나타나면 이 랩에서 사용 중인 구독을 선택하고 **스토리지 만들기**를 클릭합니다. 

1. Cloud Shell 창에서 다음 명령을 실행하여 웹앱에 대한 코드가 포함된 원격 리포지토리를 복제합니다.

   ```pwsh
   git clone https://github.com/Azure-Samples/php-docs-hello-world
   ```
 
1. Cloud Shell 창에서 다음 명령을 실행하여 현재 위치를 샘플 웹앱 코드를 포함하는 로컬 리포지토리의 새로 생성된 복제본으로 설정합니다.

   ```
   Set-Location -Path $HOME/php-docs-hello-world/
   ```

1. Cloud Shell 창에서 다음 명령을 실행하여 원격 Git를 추가합니다( `[deployment_user_name]` 및 `[git_clone_url]` 자리 표시자를 이전 작업에서 식별한 **배포 자격 증명** 사용자 이름 및 **Git Clone URL**의 값으로 대체해야 합니다).

   ```
   git remote add [deployment_user_name] [git_clone_url]
   ```

    >**참고**: `git remote add`에 따른 값은 **배포 자격 증명** 사용자 이름과 일치하지 않아도 되지만 고유 값이어야 합니다.

1. Cloud Shell 창에서 다음 명령을 실행하여 샘플 웹앱 코드를 로컬 리포지토리에서 Azure 웹앱 스테이징 배포 슬롯으로 푸시합니다. (`[deployment_user_name]` 자리 표시자를 이전 작업에서 식별한 **배포 자격 증명** 사용자 이름 값으로 바꿔야 합니다).
   ```
   git push [deployment_user_name] master
   ```

1. 인증하라는 메시지가 표시되면 `[deployment_user_name]`와 해당 암호(**Pa55w0rd1234**)를 입력합니다.

1. Cloud Shell 창을 닫습니다.

1. 스테이징 슬롯 블레이드에서 **개요**를 클릭한 다음 **URL** 링크를 클릭하여 새 브라우저 탭에 기본 웹 페이지를 표시합니다.

1. 브라우저 페이지에 **Hello World!** 메시지가 표시되는지 확인하고 새 탭을 닫습니다.

#### 작업 5: 스테이징 슬롯 교체

이 작업에서는 스테이징 슬롯을 프로덕션 슬롯으로 바꿉니다.

1. 웹 앱의 프로덕션 슬롯을 표시하는 블레이드로 돌아갑니다.

1. **배포** 섹션에서 **배포 슬롯**을 클릭한 다음 **교환** 도구 모음 아이콘을 클릭합니다.

1. **교환** 블레이드에서 기본 설정을 검토하고 **교환**을 클릭합니다. 

1. 웹앱의 프로덕션 슬롯 블레이드에서 **개요**를 클릭한 다음 **URL** 링크를 클릭하여 새 브라우저탭에서 웹 사이트 홈 페이지를 표시합니다.

1. 기본 웹 페이지가 **Hello World!** 페이지로 대체되었는지 확인합니다. 

#### 작업 6: Azure 웹앱의 자동 크기 조정 구성 및 테스트

이 작업에서는 Azure 웹 앱의 자동 크기 조정을 구성하고 테스트합니다. 

1. 웹앱의 프로덕션 슬롯을 표시하는 블레이드의 **설정** 섹션에서 **확장(App Service 계획)** 을 클릭합니다.

1. **사용자 지정 자동 크기 조정**을 클릭합니다. 

    >**참고**: 웹 앱을 수동으로 확장할 수도 있습니다.

1. **메트릭 기준 크기 조정**을 선택된 상태로 두고 **+규칙 추가**를 클릭합니다.

1. **크기 조정 규칙** 블레이드에서 다음 설정을 지정합니다(다른 설정은 기본값으로 남깁니다).

    | 설정 | 값 |
    | --- |--- |
    | 메트릭 소스 | **현재 리소스** |
    | 시간 집계 | **최대** |
    | 메트릭 네임스페이스 | **App Service 계획 표준 메트릭** |
    | 메트릭 이름 | **CPU 백분율** |
    | 연산자 | **보다 큼** |
    | 크기 조정 작업을 트리거하는 메트릭 임계값 | **10** |
    | 기간(분) | **1** |
    | 시간 조직 통계 | **최대** |
    | 작업 | **다음을 기준으로 개수 늘이기** |
    | 인스턴스 수 | **1** |
    | 휴지 시간(분) | **5** |

    >**참고**: 물론 대기 기간의 연장이 없이 가능한 한 빨리 자동 크기 조정을 트리거하는 것이 목적이므로 이러한 값은 현실적인 구성을 나타내지 않습니다. 

1. **추가**를 클릭하고 **az10408vmss0 -확장** 블레이드로 돌아가 다음 설정을 지정합니다(다른 값은 기본값으로 남겨둡니다).

    | 설정 | 값 |
    | --- |--- |
    | 인스턴스 한도 최소 | **1** |
    | 인스턴스 한도 최대 | **2** |
    | 인스턴스 한도 기본값 | **1** |

1. **저장**을 클릭합니다.

1. Azure Portal 오른쪽 상단에 아이콘을 클릭하여 **Azure Cloud Shell**을 엽니다.

1. **Bash**또는 **PowerShell** 중 하나를 선택하라는 메시지가 표시되면 **PowerShell**을 선택합니다.      

1. Cloud Shell 창에서 다음 명령을 실행하여 Azure 웹 앱의 URL 주소를 확인합니다.

   ```pwsh
   $rgName = 'az104-09a-rg1'

   $webapp = Get-AzWebApp -ResourceGroupName $rgName
   ```

1. Cloud Shell 창에서 다음 명령을 실행하여 HTTP 요청을 웹 앱으로 보내는 무한 루프를 시작합니다.

   ```pwsh
   while ($true) { Invoke-WebRequest -Uri $webapp.DefaultHostName }
   ```

1. Cloud Shell 창을 최소화하고(닫지는 않음) 웹 앱 블레이드의 **모니터링** 섹션에서 **프로세스 탐색기**를 클릭합니다.

    >**참고**: 프로세스 탐색기로 인스턴스 수와 해당 리소스 사용률을 모니터링할 수 있습니다. 

1. 몇 분 동안 사용률과 인스턴스 수를 모니터링합니다.

    >**참고**: 페이지를 **새로 고침**해야 할 수 있습니다.

1. 인스턴스 수가 2개로 증가하면 Cloud Shell 창을 다시 열고 **Ctrl+C**를 눌러 스크립트를 종료합니다.

1. Cloud Shell 창을 닫습니다.

#### 리소스 정리

   >**참고**: 더 이상 사용하지 않는 새로 만든 Azure 리소스를 제거해야 합니다. 사용하지 않는 리소스를 제거하면 해당 비용이 발생하지 않습니다.

1. Azure Portal에서 **Cloud Shell** 창 내부의 **PowerShell** 세션을 엽니다.

1. 다음 명령을 실행하여 본 모듈의 랩 전체에서 만든 모든 리소스 그룹을 나열합니다.

   ```pwsh
   Get-AzResourceGroup -Name 'az104-09a*'
   ```

1. 다음 명령을 실행하여 본 모듈의 랩 전체에서 만든 모든 리소스 그룹을 삭제합니다.

   ```pwsh
   Get-AzResourceGroup -Name 'az104-09a*' | Remove-AzResourceGroup -Force -AsJob
   ```

    >**참고**: 명령은 비동기적으로 실행(-AsJob 매개 변수에 의해 결정)되므로 동일한 PowerShell 세션 내에서 즉시 다른 PowerShell 명령을 실행할 수 있지만 리소스 그룹이 실제로 제거되기까지 몇 분 정도 걸릴 수 있습니다.

#### 리뷰

이 랩에서는 다음 작업을 했습니다.

- Azure 웹앱 만들기
- 스테이징 배포 슬롯 만들기
- 웹앱 배포 설정 구성
- 스테이징 배포 슬롯에 코드 배포
- 스테이징 슬롯 교환
- Azure 웹앱의 자동 크기 조정 구성 및 테스트
